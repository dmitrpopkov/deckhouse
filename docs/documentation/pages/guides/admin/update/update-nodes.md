---
title: Обновление узлов в кластере
permalink: ru/update/update-nodes/
lang: ru
---

spec.update
ОБЪЕКТ
spec.update.maxConcurrent
СТРОКА ИЛИ ЧИСЛО
Максимальное количество одновременно обновляемых узлов.
Можно указать число узлов или процент от общего количества узлов в данной группе.

Deckhouse Kubernetes Platform (DKP) позволяет настроить для группы узлов режим выдачи разрешения на обновления, приводящие к возможному простою — disruption-обновления. При обновлении узел освобождается от нагрузки (drain), после чего перезагружается, обновляется и вводится в работу.

Можно выбрать один из следующих режимов:
* `Automatic` — выбран по умолчанию. Разрешения на disruption-обновления выдаются автоматически.
* `Manual` — включает ручное подтверждение disruption-обновлений.
* `RollingUpdate` — начинает скользящее обновление, при котором создает новый узел и удаляет старый. Работает только для облачных узлов.

## Настройка окон обновлений

spec.disruptions.automatic
ОБЪЕКТ
Дополнительные параметры для режима Automatic.
spec.disruptions.automatic.drainBeforeApproval
БУЛЕВЫЙ
Выгон (draining) подов с узла перед выдачей разрешения на disruption.
Внимание! Данная настройка игнорируется (узлам будет выдано разрешение без предварительного выгона подов с узлов):
для nodeGroup master с единственным узлом;
для выделенного под запуск Deckhouse узла, если этот узел в группе узлов единственно рабочий (Ready).
По умолчанию:
true
spec.disruptions.automatic.windows
МАССИВ ОБЪЕКТОВ
Список окон disruption-обновлений узлов.
spec.disruptions.automatic.windows.days
МАССИВ СТРОК
Дни недели, в которые применяется окно обновлений.
Примеры:
days: Mon
days: Wed
Элемент массива
СТРОКА
День недели.
Допустимые значения:
Mon, Tue, Wed, Thu, Fri, Sat, Sun
spec.disruptions.automatic.windows.from
СТРОКА
ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР
Время начала окна обновления (в часовом поясе UTC).
Шаблон:
^(?:\d|[01]\d|2[0-3]):[0-5]\d$
Пример:
from: '13:00'
spec.disruptions.automatic.windows.to
СТРОКА
ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР
Время окончания окна обновления (в часовом поясе UTC).
Шаблон:
^(?:\d|[01]\d|2[0-3]):[0-5]\d$
Пример:
to: '18:30'

## Ручной подтверждение

команда, алерт, условия освобождения узла, пример

spec.disruptions.approvalMode
Режим выдачи разрешения на disruptive-обновление (обновление, требующее прерывание работы узла):
Manual — отключить автоматическую выдачу разрешений на disruptive-обновление. Если потребуется disruptive-обновление, загорится специальный алерт. Внимание! Для группы узлов master режим выдачи разрешения всегда должен быть Manual, чтобы избежать проблем при drain’е узла.
Automatic — автоматически выдавать разрешения на disruptive-обновление.
RollingUpdate — в этом режиме будет создан новый узел с обновленными настройками, а старый узел будет удален. Разрешено только для облачных узлов.
Когда не используется режим RollingUpdate, при обновлении узел освобождается от нагрузки (drain), после чего обновляется (перезагружается) и вводится в работу. Обратите внимание, что в этом случае в кластере должно быть место для размещения нагрузки на время, пока обновляемый узел недоступен. В режиме RollingUpdate узел заменяется на обновленный, то есть на время обновления в кластере появляется дополнительный узел. В облачной инфраструктуре режим RollingUpdate удобен, например, если в кластере нет ресурсов для временного размещения нагрузки с обновляемого узла.

Пример:
disruptions:
  approvalMode: Automatic
  automatic:
    drainBeforeApproval: false
    windows:
    - from: '06:00'
      to: '08:00'
      days:
      - Tue
      - Sun

<!-- Для мастер-узлов режим выдачи всегда должен быть `Manual`, чтобы избежать проблем при освобождении узла от нагрузки (drain). + загорается алерт -->

## Скользящее обновление

spec.disruptions
Параметры обновлений, приводящих к возможному простою.
Пример:
disruptions:
  approvalMode: Automatic
  automatic:
    drainBeforeApproval: false
    windows:
    - from: '06:00'
      to: '08:00'
      days:
      - Tue
      - Sun
spec.disruptions.approvalMode
Режим выдачи разрешения на disruptive-обновление (обновление, требующее прерывание работы узла):
Manual — отключить автоматическую выдачу разрешений на disruptive-обновление. Если потребуется disruptive-обновление, загорится специальный алерт. Внимание! Для группы узлов master режим выдачи разрешения всегда должен быть Manual, чтобы избежать проблем при drain’е узла.
Automatic — автоматически выдавать разрешения на disruptive-обновление.
RollingUpdate — в этом режиме будет создан новый узел с обновленными настройками, а старый узел будет удален. Разрешено только для облачных узлов.
Когда не используется режим RollingUpdate, при обновлении узел освобождается от нагрузки (drain), после чего обновляется (перезагружается) и вводится в работу. Обратите внимание, что в этом случае в кластере должно быть место для размещения нагрузки на время, пока обновляемый узел недоступен. В режиме RollingUpdate узел заменяется на обновленный, то есть на время обновления в кластере появляется дополнительный узел. В облачной инфраструктуре режим RollingUpdate удобен, например, если в кластере нет ресурсов для временного размещения нагрузки с обновляемого узла.
По умолчанию:
"Automatic"
Допустимые значения:
Manual, Automatic, RollingUpdate

spec.disruptions.rollingUpdate
ОБЪЕКТ
Дополнительные параметры для режима RollingUpdate.
spec.disruptions.rollingUpdate.windows
МАССИВ ОБЪЕКТОВ
Список окон disruption-обновлений узлов.
spec.disruptions.rollingUpdate.windows.days
МАССИВ СТРОК
Дни недели, в которые применяется окно обновлений.
Примеры:
days: Mon
days: Wed
Элемент массива
СТРОКА
День недели.
Допустимые значения:
Mon, Tue, Wed, Thu, Fri, Sat, Sun
spec.disruptions.rollingUpdate.windows.from
СТРОКА
ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР
Время начала окна обновления (в часовом поясе UTC).
Шаблон:
^(?:\d|[01]\d|2[0-3]):[0-5]\d$
Пример:
from: '13:00'
spec.disruptions.rollingUpdate.windows.to
СТРОКА
ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР
Время окончания окна обновления (в часовом поясе UTC).
